Recently, there has been a significant escalation in both academic and industrial commitment towards the development of autonomous driving systems (ADSs). A number of simulation testing approaches have been proposed to generate diverse driving scenarios for ADS testing. However, scenarios generated by these previous approaches are static and lack interactions between the EGO vehicle and the NPC vehicles, resulting in a large amount of time on average to find violation scenarios. Besides, a large number of the violations they found are caused by aggressive behaviors of NPC vehicles, revealing none bugs of ADS. 

In this work, we propose the concept of adversarial NPC vehicles and introduce AdvFuzz, a novel simulation testing approach, to generate adversarial scenarios on main lanes (e.g., urban roads and highways). AdvFuzz allows NPC vehicles to dynamically interact with the EGO vehicle and regulates the behaviors of NPC vehicles, finding more violation scenarios caused by the EGO vehicle more quickly. We compare AdvFuzz with a random approach and three state-of-the-art scenario-based testing approaches. Our experiments demonstrate that AdvFuzz can generate 198.34\% more violation scenarios compared to the other four approaches in 12 hours and increase the proportion of violations caused by the EGO vehicle to 87.04\%, which is more than 7 times that of other approaches. Additionally, AdvFuzz is at least 51.98\% faster in finding one violation scenario, 92.21\% faster in finding one violation caused by the EGO vehicle, 58.32\% faster in finding the first violation and 82.60\% faster in finding the first violation caused by the EGO vehicle than those of the other approaches.


<!-- <table>
  <tr>
    <td>
      <img src="img/type1.gif" alt="type1" style="width: 100%;" />
      <p align="center">Type 1: EGO rear-ends NPC changing lanes</p>
    </td>
    <td>
      <img src="img/type2.gif" alt="type2" style="width: 100%;" />
      <p align="center">Type 2: EGO hits the side of a NPC</p>
    </td>
  <tr>
    <tr>
    <td>
      <img src="img/type3.gif" alt="type3" style="width: 100%;" />
      <p align="center">Type 3: EGO collides with a NPC</p>
    </td>
    <td>
      <img src="img/type4.gif" alt="type4" style="width: 100%;" />
      <p align="center">Type 4: EGO hits the rear of a NPC</p>
    </td>
  </tr>
  <tr>
    <td>
      <img src="img/type5.gif" alt="type5" style="width: 100%;" />
      <p align="center">Type 5: EGO hits other NPCs stuck on lane</p>
    </td>
    <td>
      <img src="img/type6.gif" alt="type6" style="width: 100%;" />
      <p align="center">Type 6: EGO changes across yellow line</p>
    </td>
  <tr>
    <tr>
    <td>
      <img src="img/type7.gif" alt="type7" style="width: 100%;" />
      <p align="center">Type 7: EGO hits the yellow line. </p>
    </td>
    <td>
      <img src="img/type8.gif" alt="type8" style="width: 100%;" />
      <p align="center">Type 8: EGO fails to plan trajectory</p>
    </td>
  </tr>
  <tr>
    <td>
      <img src="img/type9.gif" alt="type9" style="width: 100%;" />
      <p align="center">Type 9: EGO hits the rear of an NPC</p>
    </td>
    <td>
      <img src="img/type10.gif" alt="type10" style="width: 100%;" />
      <p align="center">Type 10: EGO side-collides with an NPC</p>
    </td>
  </tr>
  <tr>
    <td>
      <img src="img/type11.gif" alt="type11" style="width: 100%;" />
      <p align="center">Type 11: EGO hits the side of NPC</p>
    </td>
    <td>
      <img src="img/type12.gif" alt="type12" style="width: 100%;" />
      <p align="center">Type 12: EGO collides with NPC</p>
    </td>
  </tr>
  <tr>
    <td>
      <img src="img/type13.gif" alt="type13" style="width: 100%;" />
      <p align="center">Type 13: EGO collides with two NPC vehicles.</p>
    </td>
    <td>
      <img src="img/type14.gif" alt="type14" style="width: 100%;" />
      <p align="center">Type 14: EGO fails to plan trajectory</p>
    </td>
  </tr>
</table>


**Note:** To replicate specific experimental scenarios in this documentation, refer to the data stored in the /records folder.

## Waypoints Generation and Speed Planning

**LEFT_CHANGE maneuver** 

<table>
  <tr>
    <td>
      <img src="img/ST_graph1.png" alt="ST_graph1" style="width: 100%;" />
      <p align="center" style="font-size: 12px;">Waypoints Generation of Adversarial NPC Vehicles</p>
    </td>
    <td>
      <img src="img/ST_graph2.png" alt="ST_graph2" style="width: 100%;" />
      <p align="center" style="font-size: 12px;">Speed Planning of Adversarial NPC Vehicles</p>
    </td>
  </tr>
</table>

**Right_CHANGE maneuver**

<table>
  <tr>
    <td>
      <img src="img/ST_graph4.png" alt="ST_graph4" style="width: 100%;" />
      <p align="center" style="font-size: 12px;">Waypoints Generation of Adversarial NPC Vehicles</p>
    </td>
    <td>
      <img src="img/ST_graph2.png" alt="ST_graph2" style="width: 100%;" />
      <p align="center" style="font-size: 12px;">Speed Planning of Adversarial NPC Vehicles</p>
    </td>
  </tr>
</table>

**ACCELERATION_STRAIGHT maneuver**

<table>
  <tr>
    <td>
      <img src="img/ST_graph6.png" alt="ST_graph5" style="width: 100%;" />
      <p align="center" style="font-size: 12px;">Waypoints Generation of Adversarial NPC Vehicles</p>
    </td>
    <td>
      <img src="img/ST_graph2.png" alt="ST_graph6" style="width: 100%;" />
      <p align="center" style="font-size: 12px;">Speed Planning of Adversarial NPC Vehicles</p>
    </td>
  </tr>
</table>

**DECELERATION_STRAIGHT maneuver**

<table>
  <tr>
    <td>
      <img src="img/ST_graph5.png" alt="ST_graph7" style="width: 100%;" />
      <p align="center" style="font-size: 12px;">Waypoints Generation of Adversarial NPC Vehicles</p>
    </td>
    <td>
      <img src="img/ST_graph2.png" alt="ST_graph8" style="width: 100%;" />
      <p align="center" style="font-size: 12px;">Speed Planning of Adversarial NPC Vehicles</p>
    </td>
  </tr>
</table> -->

## Overview
![Overview Image](/img/Overview_01.png)

## Examples of Generated Scenarios
Here are some dynamically generated scenarios using AdvFuzz, showcasing how the EGO vehicle interacts with adversarial NPC vehicles:

| ![type1](img/type1.gif) | ![type2](img/type2.gif) |
|:------------------------:|:------------------------:|
| Type 1: EGO rear-ends NPC changing lanes | Type 2: EGO hits the side of a NPC |
| ![type3](img/type3.gif) | ![type4](img/type4.gif) |
| Type 3: EGO collides with a NPC | Type 4: EGO hits the rear of a NPC |
| ![type5](img/type5.gif) | ![type6](img/type6.gif) |
| Type 5: EGO hits other NPCs stuck on lane | Type 6: EGO changes across yellow line |
| ![type7](img/type7.gif) | ![type8](img/type8.gif) |
| Type 7: EGO hits the yellow line | Type 8: EGO fails to plan trajectory |
| ![type9](img/type9.gif) | ![type10](img/type10.gif) |
| Type 9: EGO hits the rear of an NPC | Type 10: EGO side-collides with an NPC |
| ![type11](img/type11.gif) | ![type12](img/type12.gif) |
| Type 11: EGO hits the side of NPC | Type 12: EGO collides with NPC |
| ![type13](img/type13.gif) | ![type14](img/type14.gif) |
| Type 13: EGO collides with two NPC vehicles. | Type 14: EGO fails to plan trajectory |

**Note:** To replicate specific experimental scenarios in this documentation, refer to the data stored in the `/records` folder.

## Waypoints Generation and Speed Planning

**LEFT_CHANGE maneuver**

| ![ST_graph1](img/ST_graph1.png) | ![ST_graph2](img/ST_graph2.png) |
|:-------------------------------:|:-------------------------------:|
| Waypoints Generation of Adversarial NPC Vehicles | Speed Planning of Adversarial NPC Vehicles |

**Right_CHANGE maneuver**

| ![ST_graph4](img/ST_graph4.png) | ![ST_graph2](img/ST_graph2.png) |
|:-------------------------------:|:-------------------------------:|
| Waypoints Generation of Adversarial NPC Vehicles | Speed Planning of Adversarial NPC Vehicles |

**ACCELERATION_STRAIGHT maneuver**

| ![ST_graph6](img/ST_graph6.png) | ![ST_graph2](img/ST_graph2.png) |
|:-------------------------------:|:-------------------------------:|
| Waypoints Generation of Adversarial NPC Vehicles | Speed Planning of Adversarial NPC Vehicles |

**DECELERATION_STRAIGHT maneuver**

| ![ST_graph5](img/ST_graph5.png) | ![ST_graph2](img/ST_graph2.png) |
|:-------------------------------:|:-------------------------------:|
| Waypoints Generation of Adversarial NPC Vehicles | Speed Planning of Adversarial NPC Vehicles |
